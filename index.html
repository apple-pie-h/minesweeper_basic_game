<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Minesweeper Game</title>
  <style>
    :root {
      --bg-gradient: linear-gradient(to bottom right, #e1f5fe, #fce4ec);
      --cell: #b0bec5;
      --cell-hover: #90a4ae;
      --cell-revealed: #eceff1;
      --cell-flag: #ffd54f;
      --bomb: #ef5350;
      --grid-gap: 3px;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 20px;
      background: var(--bg-gradient);
      color: #333;
      text-align: center;
      min-height: 100vh;
    }

    h1 {
      margin-bottom: 10px;
    }

    #topbar {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    #scoreboard {
      margin-bottom: 15px;
      font-size: 14px;
      color: #555;
    }

    #game {
      display: grid;
      gap: var(--grid-gap);
      justify-content: center;
      touch-action: manipulation;
      padding: 10px;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      margin: auto;
    }

    .cell {
      width: 35px;
      height: 35px;
      background-color: var(--cell);
      border: 1px solid #78909c;
      font-size: 16px;
      font-weight: bold;
      line-height: 35px;
      cursor: pointer;
      user-select: none;
      border-radius: 5px;
      transition: background-color 0.2s, transform 0.1s;
    }

    .cell:hover:not(.revealed):not(.flagged) {
      background-color: var(--cell-hover);
      transform: scale(1.05);
    }

    .cell.revealed {
      background-color: var(--cell-revealed);
      cursor: default;
    }

    .cell.bomb {
      background-color: var(--bomb);
      color: white;
    }

    .cell.flagged {
      background-color: var(--cell-flag);
    }

    select, button {
      padding: 6px 12px;
      border: 1px solid #bbb;
      border-radius: 5px;
      font-size: 14px;
      background: white;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    select:hover, button:hover {
      background: #f0f0f0;
    }

    #timer, #flags {
      font-size: 16px;
      font-weight: 500;
    }
  </style>
</head>
<body>

<h1>üí£ Minesweeper üí£</h1>

<div id="topbar">
  <label for="difficulty">Difficulty:</label>
  <select id="difficulty">
    <option value="easy">Easy (8x8, 10 bombs)</option>
    <option value="medium" selected>Medium (10x10, 15 bombs)</option>
    <option value="hard">Hard (12x12, 25 bombs)</option>
  </select>
  <button onclick="initGame()">üîÑ Restart</button>
  <span id="timer">‚è± 0s</span>
  <span id="flags">üö© 0</span>
</div>

<div id="scoreboard">üèÜ Best Times ‚Üí Easy: -- | Medium: -- | Hard: --</div>
<div id="game"></div>

<!-- Sound Effects -->
<audio id="sound-click" src="https://assets.mixkit.co/sfx/download/mixkit-select-click-1109.wav"></audio>
<audio id="sound-flag" src="https://assets.mixkit.co/sfx/download/mixkit-game-click-1114.wav"></audio>
<audio id="sound-win" src="https://assets.mixkit.co/sfx/download/mixkit-game-level-completed-2059.wav"></audio>
<audio id="sound-lose" src="https://assets.mixkit.co/sfx/download/mixkit-wrong-answer-fail-notification-946.wav"></audio>

<script>
  let gridSize = 10;
  let bombCount = 15;
  let gameBoard = [];
  let timerInterval;
  let timeElapsed = 0;
  let flagCount = 0;
  let gameOver = false;
  let firstClick = true;

  const sounds = {
    click: document.getElementById('sound-click'),
    flag: document.getElementById('sound-flag'),
    win: document.getElementById('sound-win'),
    lose: document.getElementById('sound-lose')
  };

  const difficultySettings = {
    easy: { size: 8, bombs: 10 },
    medium: { size: 10, bombs: 15 },
    hard: { size: 12, bombs: 25 }
  };

  document.getElementById("difficulty").addEventListener("change", initGame);

  function startTimer() {
    clearInterval(timerInterval);
    timeElapsed = 0;
    document.getElementById("timer").textContent = `‚è± 0s`;
    timerInterval = setInterval(() => {
      timeElapsed++;
      document.getElementById("timer").textContent = `‚è± ${timeElapsed}s`;
    }, 1000);
  }

  function initGame() {
    clearInterval(timerInterval);
    gameOver = false;
    firstClick = true;
    const difficulty = document.getElementById("difficulty").value;
    gridSize = difficultySettings[difficulty].size;
    bombCount = difficultySettings[difficulty].bombs;
    const game = document.getElementById('game');
    game.innerHTML = '';
    game.style.gridTemplateColumns = `repeat(${gridSize}, 35px)`;
    gameBoard = [];
    flagCount = 0;
    document.getElementById("flags").textContent = `üö© ${flagCount}`;
    document.getElementById("timer").textContent = `‚è± 0s`;

    for (let r = 0; r < gridSize; r++) {
      const row = [];
      for (let c = 0; c < gridSize; c++) {
        row.push({ bomb: false, revealed: false, count: 0, flagged: false });
      }
      gameBoard.push(row);
    }

    let placed = 0;
    while (placed < bombCount) {
      const r = Math.floor(Math.random() * gridSize);
      const c = Math.floor(Math.random() * gridSize);
      if (!gameBoard[r][c].bomb) {
        gameBoard[r][c].bomb = true;
        placed++;
      }
    }

    for (let r = 0; r < gridSize; r++) {
      for (let c = 0; c < gridSize; c++) {
        if (!gameBoard[r][c].bomb) {
          let count = 0;
          for (let dr = -1; dr <= 1; dr++) {
            for (let dc = -1; dc <= 1; dc++) {
              const nr = r + dr;
              const nc = c + dc;
              if (nr >= 0 && nr < gridSize && nc >= 0 && nc < gridSize && gameBoard[nr][nc].bomb) {
                count++;
              }
            }
          }
          gameBoard[r][c].count = count;
        }
      }
    }

    for (let r = 0; r < gridSize; r++) {
      for (let c = 0; c < gridSize; c++) {
        const cell = document.createElement('div');
        cell.classList.add('cell');
        cell.dataset.row = r;
        cell.dataset.col = c;

        cell.addEventListener('click', () => handleReveal(r, c));
        cell.addEventListener('contextmenu', (e) => {
          e.preventDefault();
          handleFlag(r, c);
        });

        game.appendChild(cell);
      }
    }

    updateScoreboard();
  }

  function handleFlag(r, c) {
    if (gameOver) return;
    const cell = gameBoard[r][c];
    if (cell.revealed) return;
    const cellEl = getCellElement(r, c);

    sounds.flag.play();

    if (!cell.flagged) {
      cell.flagged = true;
      flagCount++;
      cellEl.classList.add('flagged');
      cellEl.textContent = 'üö©';
    } else {
      cell.flagged = false;
      flagCount--;
      cellEl.classList.remove('flagged');
      cellEl.textContent = '';
    }
    document.getElementById("flags").textContent = `üö© ${flagCount}`;
  }

  function handleReveal(r, c) {
    if (gameOver) return;
    const cell = gameBoard[r][c];
    if (cell.revealed || cell.flagged) return;

    if (firstClick) {
      startTimer();
      firstClick = false;
    }

    const cellEl = getCellElement(r, c);
    cell.revealed = true;
    cellEl.classList.add('revealed');

    sounds.click.play();

    if (cell.bomb) {
      cellEl.classList.add('bomb');
      cellEl.textContent = 'üí£';
      revealAll();
      clearInterval(timerInterval);
      gameOver = true;
      sounds.lose.play();
      showLoseMeme();
    } else {
      if (cell.count > 0) {
        cellEl.textContent = cell.count;
      } else {
        for (let dr = -1; dr <= 1; dr++) {
          for (let dc = -1; dc <= 1; dc++) {
            const nr = r + dr;
            const nc = c + dc;
            if (nr >= 0 && nr < gridSize && nc >= 0 && nc < gridSize) {
              handleReveal(nr, nc);
            }
          }
        }
      }
      checkWin();
    }
  }

  function revealAll() {
    for (let r = 0; r < gridSize; r++) {
      for (let c = 0; c < gridSize; c++) {
        const cell = gameBoard[r][c];
        const cellEl = getCellElement(r, c);
        if (!cell.revealed) {
          cellEl.classList.add('revealed');
          if (cell.bomb) {
            cellEl.textContent = 'üí£';
            cellEl.classList.add('bomb');
          } else if (cell.count > 0) {
            cellEl.textContent = cell.count;
          }
        }
      }
    }
  }

  function checkWin() {
    let revealedCount = 0;
    for (let r = 0; r < gridSize; r++) {
      for (let c = 0; c < gridSize; c++) {
        if (gameBoard[r][c].revealed) revealedCount++;
      }
    }
    if (revealedCount === gridSize * gridSize - bombCount) {
      clearInterval(timerInterval);
      gameOver = true;
      sounds.win.play();
      saveBestTime();
      showWinMeme();
    }
  }

  function showWinMeme() {
    const meme = document.createElement("div");
    meme.innerHTML = `
      <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                  background: rgba(0,0,0,0.6); display: flex; align-items: center;
                  justify-content: center; z-index: 1000;">
        <div style="background: white; padding: 20px; border-radius: 10px;
                    text-align: center; max-width: 90%; box-shadow: 0 5px 20px rgba(0,0,0,0.3);">
          <h2>üéâ You Win! üéâ</h2>
          <img src="https://media.tenor.com/j2YfMZRxmfYAAAAC/mr-bean-congratulations.gif"
               alt="You Win Meme" style="max-width: 100%; border-radius: 10px;" />
          <br><br>
          <button onclick="this.parentElement.parentElement.remove()">Close</button>
        </div>
      </div>
    `;
    document.body.appendChild(meme);
  }

  function showLoseMeme() {
    const meme = document.createElement("div");
    meme.innerHTML = `
      <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                  background: rgba(0,0,0,0.6); display: flex; align-items: center;
                  justify-content: center; z-index: 1000;">
        <div style="background: white; padding: 20px; border-radius: 10px;
                    text-align: center; max-width: 90%; box-shadow: 0 5px 20px rgba(0,0,0,0.3);">
          <h2>üí• You Lost! üí•</h2>
          <img src="https://media.tenor.com/ALrZz3UcwfsAAAAC/homer-simpson-bush.gif"
               alt="You Lose Meme" style="max-width: 100%; border-radius: 10px;" />
          <br><br>
          <button onclick="this.parentElement.parentElement.remove()">Try Again</button>
        </div>
      </div>
    `;
    document.body.appendChild(meme);
  }

  function saveBestTime() {
    const difficulty = document.getElementById("difficulty").value;
    const key = `bestTime-${difficulty}`;
    const best = localStorage.getItem(key);
    if (!best || timeElapsed < parseInt(best)) {
      localStorage.setItem(key, timeElapsed);
      updateScoreboard();
    }
  }

  function updateScoreboard() {
    const difficulties = ["easy", "medium", "hard"];
    const scores = difficulties.map(diff => {
      const time = localStorage.getItem(`bestTime-${diff}`);
      return `${diff.charAt(0).toUpperCase() + diff.slice(1)}: ${time ? time + 's' : '--'}`;
    });
    document.getElementById("scoreboard").innerText = `üèÜ Best Times ‚Üí ${scores.join(" | ")}`;
  }

  function getCellElement(r, c) {
    return document.querySelector(`.cell[data-row="${r}"][data-col="${c}"]`);
  }

  window.onload = initGame;
</script>

</body>
</html>
