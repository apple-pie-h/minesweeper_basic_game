<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Minesweeper Game</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      text-align: center;
    }
    h1 {
      margin-bottom: 10px;
    }
    #topbar {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }
    #game {
      display: grid;
      gap: 2px;
      justify-content: center;
      touch-action: manipulation;
    }
    .cell {
      width: 30px;
      height: 30px;
      background-color: #ccc;
      border: 1px solid #999;
      font-size: 16px;
      line-height: 30px;
      cursor: pointer;
      user-select: none;
    }
    .cell.revealed {
      background-color: #eee;
      cursor: default;
    }
    .cell.bomb {
      background-color: red;
    }
    .cell.flagged {
      background-color: #ffea00;
    }
    select, button {
      padding: 5px 10px;
    }
  </style>
</head>
<body>

<h1>Minesweeper</h1>
<div id="topbar">
  <label for="difficulty">Difficulty:</label>
  <select id="difficulty">
    <option value="easy">Easy (8x8, 10 bombs)</option>
    <option value="medium" selected>Medium (10x10, 15 bombs)</option>
    <option value="hard">Hard (12x12, 25 bombs)</option>
  </select>
  <button onclick="initGame()">Restart</button>
  <span id="timer">‚è± 0s</span>
  <span id="flags">üö© 0</span>
</div>
<div id="game"></div>

<script>
  let gridSize = 10;
  let bombCount = 15;
  let gameBoard = [];
  let timerInterval;
  let timeElapsed = 0;
  let flagCount = 0;
  let gameOver = false;

  const difficultySettings = {
    easy: { size: 8, bombs: 10 },
    medium: { size: 10, bombs: 15 },
    hard: { size: 12, bombs: 25 }
  };

  document.getElementById("difficulty").addEventListener("change", initGame);

  function startTimer() {
    clearInterval(timerInterval);
    timeElapsed = 0;
    document.getElementById("timer").textContent = `‚è± 0s`;
    timerInterval = setInterval(() => {
      timeElapsed++;
      document.getElementById("timer").textContent = `‚è± ${timeElapsed}s`;
    }, 1000);
  }

  function initGame() {
    gameOver = false;
    const difficulty = document.getElementById("difficulty").value;
    gridSize = difficultySettings[difficulty].size;
    bombCount = difficultySettings[difficulty].bombs;
    const game = document.getElementById('game');
    game.innerHTML = '';
    game.style.gridTemplateColumns = `repeat(${gridSize}, 30px)`;
    gameBoard = [];
    flagCount = 0;
    document.getElementById("flags").textContent = `üö© ${flagCount}`;

    // Setup board
    for (let r = 0; r < gridSize; r++) {
      const row = [];
      for (let c = 0; c < gridSize; c++) {
        row.push({ bomb: false, revealed: false, count: 0, flagged: false });
      }
      gameBoard.push(row);
    }

    // Place bombs
    let placed = 0;
    while (placed < bombCount) {
      const r = Math.floor(Math.random() * gridSize);
      const c = Math.floor(Math.random() * gridSize);
      if (!gameBoard[r][c].bomb) {
        gameBoard[r][c].bomb = true;
        placed++;
      }
    }

    // Calculate counts
    for (let r = 0; r < gridSize; r++) {
      for (let c = 0; c < gridSize; c++) {
        if (!gameBoard[r][c].bomb) {
          let count = 0;
          for (let dr = -1; dr <= 1; dr++) {
            for (let dc = -1; dc <= 1; dc++) {
              const nr = r + dr;
              const nc = c + dc;
              if (nr >= 0 && nr < gridSize && nc >= 0 && nc < gridSize && gameBoard[nr][nc].bomb) {
                count++;
              }
            }
          }
          gameBoard[r][c].count = count;
        }
      }
    }

    // Create cells
    for (let r = 0; r < gridSize; r++) {
      for (let c = 0; c < gridSize; c++) {
        const cell = document.createElement('div');
        cell.classList.add('cell');
        cell.dataset.row = r;
        cell.dataset.col = c;

        cell.addEventListener('click', () => handleReveal(r, c));
        cell.addEventListener('contextmenu', (e) => {
          e.preventDefault();
          handleFlag(r, c);
        });

        game.appendChild(cell);
      }
    }

    startTimer();
  }

  function handleFlag(r, c) {
    if (gameOver) return;
    const cell = gameBoard[r][c];
    if (cell.revealed) return;
    const cellEl = getCellElement(r, c);

    if (!cell.flagged) {
      cell.flagged = true;
      flagCount++;
      cellEl.classList.add('flagged');
      cellEl.textContent = 'üö©';
    } else {
      cell.flagged = false;
      flagCount--;
      cellEl.classList.remove('flagged');
      cellEl.textContent = '';
    }
    document.getElementById("flags").textContent = `üö© ${flagCount}`;
  }

  function handleReveal(r, c) {
    if (gameOver) return;
    const cell = gameBoard[r][c];
    if (cell.revealed || cell.flagged) return;

    const cellEl = getCellElement(r, c);
    cell.revealed = true;
    cellEl.classList.add('revealed');

    if (cell.bomb) {
      cellEl.classList.add('bomb');
      cellEl.textContent = 'üí£';
      alert('Game Over!');
      revealAll();
      clearInterval(timerInterval);
      gameOver = true;
    } else {
      if (cell.count > 0) {
        cellEl.textContent = cell.count;
      } else {
        // Reveal neighbors
        for (let dr = -1; dr <= 1; dr++) {
          for (let dc = -1; dc <= 1; dc++) {
            const nr = r + dr;
            const nc = c + dc;
            if (nr >= 0 && nr < gridSize && nc >= 0 && nc < gridSize) {
              handleReveal(nr, nc);
            }
          }
        }
      }
    }
  }

  function revealAll() {
    for (let r = 0; r < gridSize; r++) {
      for (let c = 0; c < gridSize; c++) {
        const cell = gameBoard[r][c];
        const cellEl = getCellElement(r, c);
        if (!cell.revealed) {
          cellEl.classList.add('revealed');
          if (cell.bomb) {
            cellEl.textContent = 'üí£';
            cellEl.classList.add('bomb');
          } else if (cell.count > 0) {
            cellEl.textContent = cell.count;
          }
        }
      }
    }
  }

  function getCellElement(r, c) {
    return document.querySelector(`.cell[data-row="${r}"][data-col="${c}"]`);
  }

  window.onload = initGame;
</script>

</body>
</html>
